const fs = require('fs')
const path = require('path')
const dirname = require('path').dirname
const process = require('process')

const tokens = require('@spark-design/tokens')
const utils = require('@spark-design/utils')
const prettier = require('prettier')
const prettierConfig = require('../../.prettierrc.js')

let aspectRatio = {}

const fonts = ['intelOneDisplay', 'intelOneText', 'intelOneMono']

const collections = {
    fonts: fonts
}
const warnText =
    '/* Do not edit this file manually! This file is generated automatically from the @spark-design/tokens package.*/'

const writeFile = (path, contents) => {
    return new Promise((res, rej) => {
        fs.mkdir(dirname(path), { recursive: true }, (err) => {
            if (err) return rej(err)

            fs.writeFile(
                path,
                prettier.format(`${warnText}\n\n${contents}`, { ...prettierConfig, parser: 'css' }),
                res
            )
        })
    })
}

Object.entries(collections).forEach(([, collection]) => {
    const imports = []
    collection.forEach((key) => {
        const { global } = tokens[key]
        const fontName = utils.toDashCase(key)

        if (global) {
            imports.push(fontName)
            writeFile(path.resolve(`./${fontName}/${fontName}.css`), global.css(aspectRatio))
        }

        writeFile(
            path.resolve(`./fonts.css`),
            imports.map((n) => `@import './${n}/${n}.css';`).join('\n')
        )
    })
})
